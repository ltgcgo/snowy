"use strict";(function(){self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),v=[],o={},y=function(s){var E;var t=this;if((this==null?void 0:this.constructor)!=y)throw new TypeError("Illegal constructor");v.push(this),(E=o[s])!=null&&E.constructor||(o[s]=[]),o[s].push(this);var i=Math.floor(Math.random()*281474976710656),M=[],f=0,l=[],h=!0,g=!1;Object.defineProperty(this,"id",{get:function(){return i}}),Object.defineProperty(this,"name",{value:s}),this.close=function(){var n;var e=v.indexOf(t);e>-1?(t.postMessage({t:"d",c:s,i:i}),v.splice(e,1),(n=o[s])!=null&&n.constructor&&(e=o[s].indexOf(t),e>-1&&o[s].splice(e,1)),o[s].length||delete o[s],console.debug("[Snowy] BroadcastChannel closed."),g=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(e){a?(a.postMessage({t:"m",c:s,i:i,m:f,d:e}),f++,f>4294967295&&(f=0)):(l.push(e),console.debug("[Snowy] Message is cached."))},this.flush=function(){if(a){if(h){for(a.postMessage({t:"r",c:s,i:i}),console.debug("[Snowy] ".concat(l.length," message(s) in cache."));l.length;){var e=l.shift();t.postMessage(e)}h=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(e){};var r={};this.dispatchEvent=function(e){var u,w;if(Object.defineProperty(e,"target",{value:t}),Object.defineProperty(e,"currentTarget",{value:t}),(u=r[e.type])!=null&&u.length)for(var n=r[e.type],c=0;c<n.length;c++)((w=n[c])==null?void 0:w.constructor)==Function&&n[c].call(t,e);t["on".concat(e.type)]&&t["on".concat(e.type)].constructor==Function&&t["on".concat(e.type)].call(t,e)},this.addEventListener=function(e,n){var u;(u=r[e])!=null&&u.constructor||(r[e]=[]);var c=r[e].indexOf(n);c==-1&&r[e].push(n)},this.removeEventListener=function(e,n){var u,w;if((u=r[e])!=null&&u.length){var c=r[e].indexOf(n);c>-1&&r[e].splice(c,1)}!((w=r[e])!=null&&w.length)&&r[e].constructor&&delete r[e]}},self.BroadcastChannel=y,b=function(){if(a){a.addEventListener("message",function(t){var i=t.data,M=!0;switch(i.t){case"k":{M=!1,a.postMessage({t:"k"});break}case"m":{var f=o[i.c];if(f!=null&&f.length)for(var l=0;l<f.length;l++)f[l].receiveMessage(i);break}case"c":{for(var h=[],g=0;g<v.length;g++){var r=v[g].name;h.indexOf(r)<0&&h.push(r)}a.postMessage({t:"k",c:h});break}default:}M&&console.info("ReceiveBroadcast",i)});for(var s=0;s<v.length;s++)v[s].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},O=function(){if(!a){var s=new SharedWorker(self.SNOWY_PATH||"/snowy.js");s.port.start();var t=function(i){i.data.t=="swc"&&(s.port.removeEventListener("message",t),a=s.port,a.postMessage({t:"k"}),b())};s.port.addEventListener("message",t)}},O());var a,v,o,y,b,O;})();
