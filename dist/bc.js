"use strict";(function(){self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),l=[],o={},h=function(s){var S;var n=this;if((this==null?void 0:this.constructor)!=h)throw new TypeError("Illegal constructor");l.push(this),(S=o[s])!=null&&S.constructor||(o[s]=[]),o[s].push(this);var u=Math.floor(Math.random()*281474976710656),b=new Set,d=0,v=[],y=!0,M=!1;this.close=function(){var t;var e=l.indexOf(n);e>-1?(n.postMessage({t:"d",c:s,i:u}),l.splice(e,1),(t=o[s])!=null&&t.constructor&&(e=o[s].indexOf(n),e>-1&&o[s].splice(e,1)),o[s].length||delete o[s],console.debug("[Snowy] BroadcastChannel closed."),M=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(e){i?(i.postMessage({t:"m",c:s,i:u,m:d,d:e}),d++):(v.push(e),console.debug("[Snowy] Message is cached."))},this.flush=function(){if(i){if(y){for(i.postMessage({t:"r",c:s,i:u});v.length;){var e=v.shift();n.postMessage(e)}y=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(e){};var r={};this.dispatchEvent=function(e){var c,f;if(Object.defineProperty(e,"target",{value:n}),Object.defineProperty(e,"currentTarget",{value:n}),(c=r[e.type])!=null&&c.length)for(var t=r[e.type],a=0;a<t.length;a++)((f=t[a])==null?void 0:f.constructor)==Function&&t[a].call(n,e);n["on".concat(e.type)]&&n["on".concat(e.type)].constructor==Function&&n["on".concat(e.type)].call(n,e)},this.addEventListener=function(e,t){var c;(c=r[e])!=null&&c.constructor||(r[e]=[]);var a=r[e].indexOf(t);a==-1&&r[e].push(t)},this.removeEventListener=function(e,t){var c,f;if((c=r[e])!=null&&c.length){var a=r[e].indexOf(t);a>-1&&r[e].splice(a,1)}!((f=r[e])!=null&&f.length)&&r[e].constructor&&delete r[e]}},self.BroadcastChannel=h,g=function(){if(i){i.addEventListener("message",function(n){var u=n.data});for(var s=0;s<l.length;s++)l[s].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},w=function(){if(!i){var s=new SharedWorker(self.SNOWY_PATH||"/snowy.js");i=s.port,i.start(),i.postMessage({t:"k"}),g()}},navigator.serviceWorker&&navigator.serviceWorker.register?navigator.serviceWorker.register(self.SNOWY_PATH||"/snowy.js").then(function(s){console.debug("[Snowy] Snowy is utilizing a global Service Worker."),i=s.active||s.installing||s.waiting,i.postMessage({t:"k"}),i.addEventListener("statechange",function(){i.postMessage({t:"k"})}),g()}).catch(function(s){console.debug("[Snowy] Service Worker registration failed. Utilizing a global Shared Worker instead.\n	".concat(s)),w()}):(console.debug("[Snowy] Snowy is utilizing a global Shared Worker."),w()));var i,l,o,h,g,w;})();
