"use strict";(function(){self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),l=[],o={},g=function(s){var d;var t=this;if((this==null?void 0:this.constructor)!=g)throw new TypeError("Illegal constructor");l.push(this),(d=o[s])!=null&&d.constructor||(o[s]=[]),o[s].push(this);var c=Math.floor(Math.random()*281474976710656),S=new Set,h=0,v=[],w=!0,M=!1;this.close=function(){var i;var e=l.indexOf(t);e>-1?(t.postMessage({t:"d",c:s,i:c}),l.splice(e,1),(i=o[s])!=null&&i.constructor&&(e=o[s].indexOf(t),e>-1&&o[s].splice(e,1)),o[s].length||delete o[s],console.debug("[Snowy] BroadcastChannel closed."),M=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(e){n?(n.postMessage({t:"m",c:s,i:c,m:h,d:e}),h++,h>4294967295&&(h=0)):(v.push(e),console.debug("[Snowy] Message is cached."))},this.flush=function(){if(n){if(w){for(n.postMessage({t:"r",c:s,i:c}),console.debug("[Snowy] ".concat(v.length," message(s) in cache."));v.length;){var e=v.shift();t.postMessage(e)}w=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(e){};var r={};this.dispatchEvent=function(e){var f,u;if(Object.defineProperty(e,"target",{value:t}),Object.defineProperty(e,"currentTarget",{value:t}),(f=r[e.type])!=null&&f.length)for(var i=r[e.type],a=0;a<i.length;a++)((u=i[a])==null?void 0:u.constructor)==Function&&i[a].call(t,e);t["on".concat(e.type)]&&t["on".concat(e.type)].constructor==Function&&t["on".concat(e.type)].call(t,e)},this.addEventListener=function(e,i){var f;(f=r[e])!=null&&f.constructor||(r[e]=[]);var a=r[e].indexOf(i);a==-1&&r[e].push(i)},this.removeEventListener=function(e,i){var f,u;if((f=r[e])!=null&&f.length){var a=r[e].indexOf(i);a>-1&&r[e].splice(a,1)}!((u=r[e])!=null&&u.length)&&r[e].constructor&&delete r[e]}},self.BroadcastChannel=g,y=function(){if(n){n.addEventListener("message",function(t){var c=t.data});for(var s=0;s<l.length;s++)l[s].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},E=function(){if(!n){var s=new SharedWorker(self.SNOWY_PATH||"/snowy.js");s.port.start();var t=function(c){c.data.t=="swc"&&(s.port.removeEventListener("message",t),n=s.port,n.postMessage({t:"k"}),y())};s.port.addEventListener("message",t)}},console.debug("[Snowy] Snowy is utilizing a global Shared Worker."),E());var n,l,o,g,y,E;})();
