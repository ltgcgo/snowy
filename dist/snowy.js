"use strict";(function(){var v=25e3,f=[],r={},t=function(e,o){var c,s;(c=r[e])!=null&&c.constructor||(r[e]=[]),r[e].indexOf(o)<0&&r[e].push(o),(s=o.ch)!=null&&s.constructor||(o.ch=[]),o.ch.indexOf(e)<0&&o.ch.push(e),console.debug("[Snowy] Subscribed tab to channel ".concat(e,"."))},g=function(e,o){var s,i;if((s=r[e])!=null&&s.constructor){var c=r[e].indexOf(o);c>-1&&r[e].splice(c,1),r[e].length||delete r[e]}if((i=o==null?void 0:o.ch)!=null&&i.constructor){var c=o.ch.indexOf(e);c>-1&&o.ch.splice(c,1)}console.debug("[Snowy] Unsubscribed tab from channel ".concat(e,"."))};addEventListener("connect",function(e){var o=e.source;o.postMessage({t:"swc"}),o.onmessage=function(c){var n;var s=c.data,i=!0;switch(s.t){case"k":{var a=f.indexOf(o);for(a<0&&f.push(o),o.lastKa=Date.now();(n=s==null?void 0:s.c)!=null&&n.length;){var u=s.c.pop();t(u,o)}i=!1;break}case"r":{t(s.c,o);break}case"m":break;default:console.error('[Snowy] Unknown message type "'.concat(s.t,'"'))}i&&console.info("SharedWorkerMessage",s)}});setInterval(function(){var i;for(var e=f.length-1;e>=0;e--){var o=f[e];o.postMessage({t:"k"});var c=Date.now();if(o.lastKa+v<c){if(o.postMessage({t:"c"}),(i=o==null?void 0:o.ch)!=null&&i.constructor)for(var s=0;s<o.ch.length;s++)g(o.ch[s],o);f.splice(e,1),console.info("[Snowy] Stopped one tab.")}}},1e4);console.info("[Snowy] Worker is now active.");})();
