"use strict";(function(){self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),v=[],f={},E=function(s){var b;var t=this;if((this==null?void 0:this.constructor)!=E)throw new TypeError("Illegal constructor");v.push(this),(b=f[s])!=null&&b.constructor||(f[s]=[]),f[s].push(this);var n=Math.floor(Math.random()*281474976710656),y=[],o=0,l=[],h=!0,g=!1;Object.defineProperty(this,"id",{get:function(){return n}}),Object.defineProperty(this,"name",{value:s}),this.close=function(){var i;var e=v.indexOf(t);e>-1?(t.postMessage({t:"d",c:s,i:n}),v.splice(e,1),(i=f[s])!=null&&i.constructor&&(e=f[s].indexOf(t),e>-1&&f[s].splice(e,1)),f[s].length||delete f[s],console.debug("[Snowy] BroadcastChannel closed."),g=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(e){r?(r.postMessage({t:"m",c:s,i:n,m:o,d:e}),o++,o>4294967295&&(o=0)):(l.push(e),console.debug("[Snowy] Message is cached."))},this.flush=function(){if(r){if(h){for(r.postMessage({t:"r",c:s,i:n}),console.debug("[Snowy] ".concat(l.length," message(s) in cache."));l.length;){var e=l.shift();t.postMessage(e)}h=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(e){};var a={};this.dispatchEvent=function(e){var u,w;if(Object.defineProperty(e,"target",{value:t}),Object.defineProperty(e,"currentTarget",{value:t}),(u=a[e.type])!=null&&u.length)for(var i=a[e.type],c=0;c<i.length;c++)((w=i[c])==null?void 0:w.constructor)==Function&&i[c].call(t,e);t["on".concat(e.type)]&&t["on".concat(e.type)].constructor==Function&&t["on".concat(e.type)].call(t,e)},this.addEventListener=function(e,i){var u;(u=a[e])!=null&&u.constructor||(a[e]=[]);var c=a[e].indexOf(i);c==-1&&a[e].push(i)},this.removeEventListener=function(e,i){var u,w;if((u=a[e])!=null&&u.length){var c=a[e].indexOf(i);c>-1&&a[e].splice(c,1)}!((w=a[e])!=null&&w.length)&&a[e].constructor&&delete a[e]}},self.BroadcastChannel=E,d=function(){if(r){r.addEventListener("message",function(t){var n=t.data,y=!0;switch(n.t){case"k":{y=!1,r.postMessage({t:"k"});break}case"m":{var o=f[n.c];if(o!=null&&o.length)for(var l=0;l<o.length;l++)o[l].receiveMessage(n);break}case"c":{for(var h=[],g=0;g<v.length;g++){var a=v[g].name;h.indexOf(a)<0&&h.push(a)}r.postMessage({t:"k",c:h});break}default:}y&&console.info("ReceiveBroadcast",n)});for(var s=0;s<v.length;s++)v[s].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},O=function(){if(!r){var s=new SharedWorker(self.SNOWY_PATH||"/snowy.js");s.port.start();var t=function(n){n.data.t=="swc"&&(s.port.removeEventListener("message",t),r=s.port,r.postMessage({t:"k"}),d())};s.port.addEventListener("message",t)}},O());var r,v,f,E,d,O;self.testChannel=new BroadcastChannel("cc.ltgc.snowy:PublicChannel");testChannel.addEventListener("message",function(s){console.info(s)});for(M=1;M<=8;M++)testChannel.postMessage("Test message #".concat(M,"!"));var M;})();
