"use strict";(function(){self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),l=[],o={},v=function(s){var S;var i=this;if((this==null?void 0:this.constructor)!=v)throw new TypeError("Illegal constructor");l.push(this),(S=o[s])!=null&&S.constructor||(o[s]=[]),o[s].push(this);var u=Math.floor(Math.random()*281474976710656),b=new Set,d=0,h=[],y=!0,M=!1;this.close=function(){var r;var e=l.indexOf(i);e>-1?(i.postMessage({t:"d",c:s,i:u}),l.splice(e,1),(r=o[s])!=null&&r.constructor&&(e=o[s].indexOf(i),e>-1&&o[s].splice(e,1)),o[s].length||delete o[s],console.debug("[Snowy] BroadcastChannel closed."),M=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(e){n?(n.postMessage({t:"m",c:s,i:u,m:d,d:e}),d++):(h.push(e),console.debug("[Snowy] Message is cached."))},this.flush=function(){if(n){if(y){for(n.postMessage({t:"r",c:s,i:u});h.length;){var e=h.shift();i.postMessage(e)}y=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(e){};var t={};this.dispatchEvent=function(e){var c,f;if(Object.defineProperty(e,"target",{value:i}),Object.defineProperty(e,"currentTarget",{value:i}),(c=t[e.type])!=null&&c.length)for(var r=t[e.type],a=0;a<r.length;a++)((f=r[a])==null?void 0:f.constructor)==Function&&r[a].call(i,e);i["on".concat(e.type)]&&i["on".concat(e.type)].constructor==Function&&i["on".concat(e.type)].call(i,e)},this.addEventListener=function(e,r){var c;(c=t[e])!=null&&c.constructor||(t[e]=[]);var a=t[e].indexOf(r);a==-1&&t[e].push(r)},this.removeEventListener=function(e,r){var c,f;if((c=t[e])!=null&&c.length){var a=t[e].indexOf(r);a>-1&&t[e].splice(a,1)}!((f=t[e])!=null&&f.length)&&t[e].constructor&&delete t[e]}},self.BroadcastChannel=v,g=function(){if(n){n.addEventListener("message",function(i){var u=i.data});for(var s=0;s<l.length;s++)l[s].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},w=function(){if(!n){var s=new SharedWorker(self.SNOWY_PATH||"/snowy.js");n=s.port,n.start(),n.postMessage({t:"k"}),g()}},navigator.serviceWorker&&navigator.serviceWorker.register?navigator.serviceWorker.register(self.SNOWY_PATH||"/snowy.js").then(function(s){console.debug("[Snowy] Snowy is utilizing a global Service Worker."),n=s.active||s.installing||s.waiting,n.postMessage({t:"k"}),n.addEventListener("statechange",function(){n.postMessage({t:"k"})}),g()}).catch(function(s){console.debug("[Snowy] Service Worker registration failed. Utilizing a global Shared Worker instead.\n	".concat(s)),w()}):(console.debug("[Snowy] Snowy is utilizing a global Shared Worker."),w()));var n,l,o,v,g,w;self.testChannel=new BroadcastChannel("cc.ltgc.snowy:PublicChannel");testChannel.addEventListener("message",function(s){console.info(s)});})();
