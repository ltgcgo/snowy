"use strict";(function(){self.BroadcastChannel?console.info("[Snowy] Snowy is disabled."):(console.info("[Snowy] Snowy is enabled. Path: ".concat(self.SNOWY_PATH||"/snowy.js")),l=[],o={},w=function(s){var y;var t=this;if((this==null?void 0:this.constructor)!=w)throw new TypeError("Illegal constructor");l.push(this),(y=o[s])!=null&&y.constructor||(o[s]=[]),o[s].push(this);var c=Math.floor(Math.random()*281474976710656),b=new Set,h=0,v=[],d=!0,S=!1;this.close=function(){var r;var e=l.indexOf(t);e>-1?(t.postMessage({t:"d",c:s,i:c}),l.splice(e,1),(r=o[s])!=null&&r.constructor&&(e=o[s].indexOf(t),e>-1&&o[s].splice(e,1)),o[s].length||delete o[s],console.debug("[Snowy] BroadcastChannel closed."),S=!0):console.debug("[Snowy] BroadcastChannel already closed.")},this.postMessage=function(e){a?(a.postMessage({t:"m",c:s,i:c,m:h,d:e}),h++,h>4294967295&&(h=0)):(v.push(e),console.debug("[Snowy] Message is cached."))},this.flush=function(){if(a){if(d){for(a.postMessage({t:"r",c:s,i:c}),console.debug("[Snowy] ".concat(v.length," message(s) in cache."));v.length;){var e=v.shift();t.postMessage(e)}d=!1,console.debug("[Snowy] All cached messages are flushed away.")}}else throw new Error("Tried to flush when the ports are not ready")},this.receiveMessage=function(e){};var n={};this.dispatchEvent=function(e){var f,u;if(Object.defineProperty(e,"target",{value:t}),Object.defineProperty(e,"currentTarget",{value:t}),(f=n[e.type])!=null&&f.length)for(var r=n[e.type],i=0;i<r.length;i++)((u=r[i])==null?void 0:u.constructor)==Function&&r[i].call(t,e);t["on".concat(e.type)]&&t["on".concat(e.type)].constructor==Function&&t["on".concat(e.type)].call(t,e)},this.addEventListener=function(e,r){var f;(f=n[e])!=null&&f.constructor||(n[e]=[]);var i=n[e].indexOf(r);i==-1&&n[e].push(r)},this.removeEventListener=function(e,r){var f,u;if((f=n[e])!=null&&f.length){var i=n[e].indexOf(r);i>-1&&n[e].splice(i,1)}!((u=n[e])!=null&&u.length)&&n[e].constructor&&delete n[e]}},self.BroadcastChannel=w,E=function(){if(a){a.addEventListener("message",function(t){var c=t.data});for(var s=0;s<l.length;s++)l[s].flush()}else throw new Error("Message port isn't yet ready");console.info("[Snowy] Snowy is active.")},M=function(){if(!a){var s=new SharedWorker(self.SNOWY_PATH||"/snowy.js");s.port.start();var t=function(c){c.data.t=="swc"&&(s.port.removeEventListener("message",t),a=s.port,a.postMessage({t:"k"}),E())};s.port.addEventListener("message",t)}},console.debug("[Snowy] Snowy is utilizing a global Shared Worker."),M());var a,l,o,w,E,M;self.testChannel=new BroadcastChannel("cc.ltgc.snowy:PublicChannel");testChannel.addEventListener("message",function(s){console.info(s)});for(g=1;g<=8;g++)testChannel.postMessage("Test message #".concat(g,"!"));var g;})();
